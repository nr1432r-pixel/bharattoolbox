<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>instagram-video-downloader</title>

  <!-- ===== CSS (INLINE) ===== -->
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #eef2f7;
    }

    .container {
      width: 320px;
      margin: 100px auto;
      padding: 20px;
      background: white;
      text-align: center;
      border-radius: 8px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    input, button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      font-size: 14px;
    }

    button {
      cursor: pointer;
      border: none;
      background: #4f46e5;
      color: white;
      border-radius: 6px;
    }

    button:hover {
      background: #3730a3;
    }

    .overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
      z-index: 999;
    }

    .popup {
      background: white;
      padding: 20px;
      width: 260px;
      border-radius: 8px;
      text-align: center;
    }

    .popup h3 {
      margin-bottom: 15px;
    }

    .popup button {
      margin-top: 8px;
    }

    .cancel {
      background: #ccc;
      color: #000;
    }

    .back {
      margin-top: 15px;
    }

    .back a {
      text-decoration: none;
      color: #2563eb;
      font-weight: bold;
    }
  </style>
</head>

<body>

<div class="container">
  <h1>â¬‡ instagram-video-downloader</h1>

  <!-- URL input -->
  <input type="url" id="urlInput" placeholder="Paste URL here">

  <!-- Trigger popup -->
  <button type="button" id="downloadBtn">Download</button>

  <div class="back">
    <a href="/">â¬… Home</a>
  </div>
</div>

<!-- ===== POPUP ===== -->
<div id="overlay" class="overlay">
  <div class="popup">

    <h3>Select Download Option</h3>

    <!-- âœ… FORM ONLY HERE -->
    <form method="POST" action="/download">
      <input type="hidden" name="url" id="hiddenUrl">
      <input type="hidden" name="option" id="hiddenOption">

      <button type="button" onclick="choose('video')">ðŸŽ¥ Video</button>
      <button type="button" onclick="choose('audio')">ðŸŽµ Audio</button>
    </form>

    <button class="cancel" onclick="closePopup()">Cancel</button>
  </div>
</div>

<!-- ===== JS (INLINE) ===== -->
<script>
  const downloadBtn = document.getElementById("downloadBtn");
  const overlay = document.getElementById("overlay");
  const urlInput = document.getElementById("urlInput");

  downloadBtn.addEventListener("click", () => {
    if (!urlInput.value.trim()) {
      alert("Paste URL first");
      return;
    }
    document.getElementById("hiddenUrl").value = urlInput.value;
    overlay.style.display = "flex";
  });

  function closePopup() {
    overlay.style.display = "none";
  }

  function choose(option) {
    document.getElementById("hiddenOption").value = option;
    document.querySelector("form").submit();
  }
  fetch("/instagram-download", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    url: document.getElementById("urlInput").value,
    option: option
  })
});
function choose(option){
  fetch("/instagram-download", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      url: document.getElementById("urlInput").value,
      option: option
    })
  })
  .then(res => {
    if (!res.ok) throw new Error("Download failed");
    return res.blob();
  })
  .then(blob => {
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = option === "audio" ? "instagram.mp3" : "instagram.mp4";
    a.click();
  })
  .catch(() => alert("Download failed"));
}
</script>

</body>
</html>
