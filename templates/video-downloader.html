<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Universal Video Downloader</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:system-ui;
  background:linear-gradient(135deg,#c7d2fe,#fbcfe8);
  padding:20px;
}

.card{
  max-width:420px;
  margin:auto;
  background:#fff;
  padding:20px;
  border-radius:20px;
  box-shadow:0 18px 40px rgba(0,0,0,.2);
}

h2{
  text-align:center;
  color:#4f46e5;
}

input{
  width:100%;
  padding:14px;
  border-radius:14px;
  border:2px solid #e5e7eb;
  margin:10px 0;
}

button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:28px;
  font-weight:800;
  background:linear-gradient(135deg,#6366f1,#4f46e5);
  color:#fff;
  cursor:pointer;
}

.format{
  margin-top:10px;
  padding:12px;
  background:#eef2ff;
  border-radius:14px;
  cursor:pointer;
  text-align:center;
  font-weight:800;
}
.format:hover{background:#e0e7ff}

/* Progress UI */
#progressBox{
  display:none;
  margin-top:16px;
}
.bar-wrap{
  background:#e5e7eb;
  height:12px;
  border-radius:20px;
  overflow:hidden;
}
.bar{
  height:100%;
  width:0%;
  background:linear-gradient(135deg,#22c55e,#16a34a);
  transition:width .5s;
}
#ptext{
  font-weight:800;
  margin-bottom:6px;
  color:#14532d;
}
</style>
</head>

<body>

<div class="card">
  <h2>üé• Universal Video Downloader</h2>

  <input id="url" placeholder="Paste YouTube / Instagram / any video link">

  <button onclick="getInfo()">Get Video</button>

  <div id="info"></div>

  <!-- Progress -->
  <div id="progressBox">
    <div id="ptext">Starting download...</div>
    <div class="bar-wrap">
      <div class="bar" id="bar"></div>
    </div>
  </div>
</div>

<script>
let VIDEO_URL = "";

async function getInfo(){
  const info = document.getElementById("info");
  VIDEO_URL = document.getElementById("url").value.trim();

  if(!VIDEO_URL){
    alert("Paste video link first");
    return;
  }

  info.innerHTML="‚è≥ Fetching video info...";

  const res = await fetch("/video-info",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ url: VIDEO_URL })
  });

  const data = await res.json();
  if(data.error){
    info.innerHTML="‚ùå Failed to fetch video";
    return;
  }

  let html = `<h4>${data.title}</h4>`;
  if(data.thumbnail){
    html += `<img src="${data.thumbnail}" style="width:100%;border-radius:14px;margin-bottom:10px">`;
  }

  data.formats.forEach(f=>{
    html += `
      <div class="format" onclick="startDownload('${f.id}')">
        ‚¨á ${f.quality} ${f.size?`(${f.size}MB)`:""}
      </div>
    `;
  });

  info.innerHTML = html;
}

async function startDownload(format){
  const box = document.getElementById("progressBox");
  const bar = document.getElementById("bar");
  const text = document.getElementById("ptext");

  // show UI instantly
  box.style.display="block";
  bar.style.width="0%";
  text.innerText="‚è≥ Starting download...";

  // fake smooth progress
  let p = 0;
  const fake = setInterval(()=>{
    if(p < 90){
      p += Math.random()*8;
      bar.style.width = Math.min(p,90) + "%";
      text.innerText = "‚¨á Downloading‚Ä¶ " + Math.floor(p) + "%";
    }
  },400);

  // allow browser to paint UI
  await new Promise(r=>setTimeout(r,300));

  try{
    const res = await fetch("/video-download",{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({
        url: VIDEO_URL,
        format: format
      })
    });

    const blob = await res.blob();

    clearInterval(fake);
    bar.style.width="100%";
    text.innerText="‚úÖ Download complete";

    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "video.mp4";
    document.body.appendChild(a);
    a.click();
    a.remove();

  }catch(err){
    clearInterval(fake);
    text.innerText="‚ùå Download failed";
    bar.style.background="#dc2626";
  }
}
</script>

</body>
</html>
